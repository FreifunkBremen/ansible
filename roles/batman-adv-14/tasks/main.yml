---
# tasks file for batman-adv-14
- name: Add repository key for batman-adv compat 14
  apt_key: keyserver="{{ pgp_keyserver }}" id="{{ batman_adv_14_repository_key }}" state=present

- name: Add repository for batman-adv compat 14
  apt_repository: repo="{{item}}"
  with_items:
    - deb {{ batman_adv_14_repository }}
    - deb-src {{ batman_adv_14_repository }}

- name: Install batman-adv compat 14
  apt: name="{{ batman_adv_14_pkg_name }}"

- name: Copy kernel postinst downgrade hook
  copy: >
    src=dkms-batman-adv-downgrade
    dest=/etc/kernel/postinst.d/dkms-batman-adv-downgrade
    mode=0755

- name: Ensure correct version was installed
  shell: /etc/kernel/postinst.d/dkms-batman-adv-downgrade $(uname -r)

- name: Enable batman during boot
  lineinfile: dest=/etc/modules line=batman-adv

- name: Load batman-adv module
  modprobe: name=batman-adv
