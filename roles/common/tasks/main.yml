---
- name: Enable tmpfs for /tmp
  replace: dest=/etc/default/tmpfs regexp='(\#\s*)?RAMTMP\s*=\s*(.*)' replace='RAMTMP=yes' backup=yes

- name: Configure APT not to install recommends packages
  copy: src=apt-recommends.conf dest=/etc/apt/apt.conf.d/40recommends owner=root group=root mode=0644 force=yes

- name: Install a bunch of helpful tools
  apt: name={{item}}
  with_items:
    - apt-transport-https
    - binutils
    - bmon
    - bsd-mailx
    - bwm-ng
    - ca-certificates
    - chrony
    - curl
    - dstat
    - debian-goodies
    - deborphan
    - etckeeper
    - ethtool
    - git
    - htop
    - inetutils-syslogd
    - iotop
    - iptables-persistent
    - jq
    - less
    - libyaml-syck-perl
    - lsb-release
    - lsof
    - mc
    - molly-guard
    - postfix
    - python
    - python3
    - psmisc
    - rkhunter
    - screen
    - ssh
    - sudo
    - tcpdump
    - unattended-upgrades
    - vim
    - vnstat
    - wget
    - xtables-addons-dkms
    - zsh

- name: Configure APT to run checkrestart after updates
  copy: src=apt-checkrestart.conf dest=/etc/apt/apt.conf.d/99checkrestart owner=root group=root mode=0644 force=yes

- name: Update SSH configuration
  replace: dest=/etc/ssh/sshd_config regexp="^([\#\s]*)?{{item.key}}\s+([\w_-]+)" replace="{{item.key}} {{item.value}}" backup=yes
  with_items:
  - key: PermitRootLogin
    value: without-password
  - key: RSAAuthentication
    value: 'no'
  - key: PasswordAuthentication
    value: 'no'
  - key: PrintLastLog
    value: 'no'

- name: Fetch and install grml zshrc
  get_url: url='http://git.grml.org/?p=grml-etc-core.git;a=blob_plain;f=etc/zsh/zshrc;hb=HEAD' dest=/etc/zsh/zshrc mode=0644 force=yes

- name: Start and enable vnstat
  service: name=vnstat state=started enabled=yes

- name: Deinstall unneeded packages
  apt: name={{item}}
  with_items:
    - nfs-common
    - rpcbind
    - at
