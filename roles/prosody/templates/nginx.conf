# {{ ansible_managed }}
server {
	listen 80;
	server_name {{jabber_domain}};
	# enforce https
	return 301 https://$server_name$request_uri;
}

server {
	server_name {{jabber_domain}};
	listen 443 ssl;
	ssl_certificate /var/lib/prosody/{{ jabber_domain }}.crt;
	ssl_certificate_key /var/lib/prosody/{{ jabber_domain }}.key;

	root /var/www/html/{{ jabber_domain }}_jabber;
	index index.html;

	location /http-bind {
		proxy_pass  http://localhost:5280/http-bind;
    #proxy_set_header Host $host;
    proxy_set_header Host "{{jabber_domain}}";
		proxy_buffering off;
		tcp_nodelay on;
	}
}
