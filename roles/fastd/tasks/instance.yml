---
- name: Check interface length
  fail:
    msg: "{{ fastd_interface }} has more than 15 characters!"
  when: fastd_interface|length > 15

- name: Create peers directory
  file: path=/etc/fastd/{{ fastd_instance }}/peers state=directory

- name: List peers
  command: ls -1 /etc/fastd/{{ fastd_instance }}/peers
  changed_when: False
  register: contents

- name: Delete peers
  file: path=/etc/fastd/{{ fastd_instance }}/peers/{{ item }} state=absent
  with_items: '{{contents.stdout_lines}}'
  notify:
  - restart fastd

- name: Create fastd directory
  file: path=/etc/fastd/{{ fastd_instance }} state=directory

- name: Upload fastd.conf
  template: src=fastd.conf dest=/etc/fastd/{{ fastd_instance }}/
  notify:
  - restart fastd

- name: Add network configuration
  template: src=interfaces dest=/etc/network/interfaces.d/{{ fastd_interface }}

- name: Firewall open fastd-port
  mf_add: role="fastd_{{fastd_instance}}" proto=udp port="{{fastd_port}}"

- name: Enable fastd instance
  service: name=fastd@{{ fastd_instance }} enabled=yes
