# {{ ansible_managed }}

# VirtualHost configuration options common to both HTTP and HTTPS sites:

ServerName {{ gatemon_subdomain }}.{{ main_domain }}
ServerAlias {{ gatemon_subdomain }}.{{ alt_domain }}

# Enable HTTPS proxying
SSLProxyEngine On

# Don't add header to proxy
ProxyAddHeaders Off

# set this to customers mail address
ServerAdmin {{ gatemon_email }}

SuexecUserGroup {{ gatemon_user }} {{ gatemon_group }}

DocumentRoot /var/www/{{ gatemon_user }}/domains/{{ gatemon_domain }}
Alias /icons /usr/share/apache2/icons
Alias /.well-known/acme-challenge /var/www/{{ gatemon_user }}/letsencrypt
ScriptAlias /cgi-bin /var/www/{{ gatemon_user }}/cgi-bin
ScriptAlias /fcgi-bin /var/www/{{ gatemon_user }}/fcgi-bin
Include /etc/apache2/user-php-exec.conf

RewriteEngine on
RewriteOptions inherit

# PHP expects a "HTTP_AUTHORIZATION" header to correctly provide PHP_AUTH_USER and PHP_AUTH_PW
RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

CustomLog /readonly/{{ gatemon_user }}/log/{{ gatemon_domain }}-access.log combined env=!dontlog
ErrorLog /readonly/{{ gatemon_user }}/log/{{ gatemon_domain }}-error.log
ErrorLogFormat "[%{u}t] [%-m:%l] [pid %P:tid %T] %7F: %E: [client\ ANONYMIZED] %M% ,\ referer\ %{Referer}i"
