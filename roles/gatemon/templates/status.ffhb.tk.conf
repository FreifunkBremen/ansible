<Directory /var/www/{{ gatemon_user }}>
  AllowOverride AuthConfig FileInfo Indexes Limit Options=ExecCGI,Indexes,MultiViews,SymLinksIfOwnerMatch
  Options +SymLinksIfOwnerMatch -Includes
</Directory>

<VirtualHost *:80>
  ServerName {{ gatemon_domain }}

  # Enable HTTPS proxying
  SSLProxyEngine On

  # Don't add header to proxy
  ProxyAddHeaders Off

  # set this to customers mail address
  ServerAdmin {{ gatemon_email }}

  SuexecUserGroup {{ gatemon_user }} {{ gatemon_user }}

  DocumentRoot /var/www/{{ gatemon_user }}/domains/{{ gatemon_domain }}
  ScriptAlias /cgi-bin /var/www/{{ gatemon_user }}/cgi-bin
  ScriptAlias /fcgi-bin /var/www/{{ gatemon_user }}/fcgi-bin
  Include /etc/apache2/user-php-exec.conf

  RewriteEngine on
  RewriteOptions inherit

  # PHP expects a "HTTP_AUTHORIZATION" header to correctly provide PHP_AUTH_USER and PHP_AUTH_PW
  RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

  CustomLog /readonly/{{ gatemon_user }}/log/default-access.log combined env=!dontlog
  ErrorLog "| /opt/space-utils/apache2-anonymize-error-log /readonly/{{ gatemon_user }}/log/default-error.log"
</VirtualHost>
