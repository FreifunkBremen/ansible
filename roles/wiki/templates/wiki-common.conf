# {{ ansible_managed }}

# VirtualHost configuration options common to both HTTP and HTTPS sites:

ServerName {{ wiki_domain }}

# Enable HTTPS proxying
SSLProxyEngine On

# Don't add header to proxy
ProxyAddHeaders Off

# set this to customers mail address
ServerAdmin {{ wiki_email }}

SuexecUserGroup {{ wiki_user }} {{ wiki_group }}

DocumentRoot /var/www/{{ wiki_user }}/domains/{{ wiki_domain }}
Alias /icons /usr/share/apache2/icons
Alias /.well-known/acme-challenge /var/www/{{ wiki_user }}/letsencrypt
ScriptAlias /cgi-bin /var/www/{{ wiki_user }}/cgi-bin
ScriptAlias /fcgi-bin /var/www/{{ wiki_user }}/fcgi-bin
Include /etc/apache2/user-php-exec.conf

RewriteEngine on
RewriteOptions inherit

# PHP expects a "HTTP_AUTHORIZATION" header to correctly provide PHP_AUTH_USER and PHP_AUTH_PW
RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

CustomLog /readonly/{{ wiki_user }}/log/default-access.log combined env=!dontlog
ErrorLog /readonly/{{ wiki_user }}/log/default-error.log
ErrorLogFormat "[%{u}t] [%-m:%l] [pid %P:tid %T] %7F: %E: [client\ ANONYMIZED] %M% ,\ referer\ %{Referer}i"
