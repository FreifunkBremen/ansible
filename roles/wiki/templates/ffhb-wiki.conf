<Directory /var/www/{{ wiki_user }}/domains/{{ wiki_domain }}/>
  AllowOverride None
  Options -Indexes

  RewriteEngine On
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteRule ^(.*)$ http://127.0.0.1:63112/$1 [P,L]

  SetEnvIfNoCase Request_URI ^/(create|edit|livepreview|delete|rename)/ require_auth=true

  AuthType basic
  AuthName "Dies ist ein Spamschutz. Benutzername: wellenfunk, Passwort: foobar"
  AuthUserFile /var/www/{{ wiki_user }}/domains/{{ wiki_domain }}/.htpasswd
  ErrorDocument 401 "Die Benutzerabfrage dient lediglich der Spamvermeidung. Die Benutzerdaten lauten: Benutzername: wellenfunk, Passwort: foobar"

  Order Deny,Allow
  Deny from All
  Satisfy any
  Allow from env=!require_auth
  Require valid-user

  # use "Home" as wiki start page
  DirectoryIndex Home
</Directory>

<VirtualHost *:80>
  ServerName {{ wiki_domain }}
  ServerAdmin {{ wiki_email }}
  DocumentRoot /var/www/{{ wiki_user }}/domains/{{ wiki_domain }}/
</VirtualHost>

<VirtualHost *:443>
  ServerName {{ wiki_domain }}
  ServerAdmin {{ wiki_email }}
  DocumentRoot /var/www/{{ wiki_user }}/domains/{{ wiki_domain }}/

  SSLEngine on
  SSLCertificateFile    /etc/ssl/certs/{{ wiki_domain }}.pem
  SSLCertificateKeyFile /etc/ssl/private/{{ wiki_domain }}.key
</VirtualHost>
