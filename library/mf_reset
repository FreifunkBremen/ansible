#!/usr/bin/python

EXAMPLES = '''
# Micro Firewall, saves json-rules for convertion to iptables
- mf_reset: role=dns
- mf_reset: all=yes
'''
from ansible.module_utils.basic import *
from json import dumps
import io
from sys import argv
from os import listdir,makedirs,remove
from os.path import join,isfile,exists

PATH = '/etc/microfirewall.d/'

def main():
	module = AnsibleModule(
		argument_spec={
			'role': { 'type': 'str'},
			'all': {'type': 'bool'},
		}
	)
	role = module.params['role']
	all = module.params['all']

	change=False
	if not exists(PATH):
		makedirs(PATH)

	if all is not None and all:
		for file in listdir(PATH):
			filename = join(PATH,file)
			if isfile(filename) and '.json' in file:
				remove(filename)
				change=True

	if role is not None:
		filename = join(PATH,role+'.json')
		if isfile(filename) and '.json' in file:
			remove(filename)
			change = True
	
	module.exit_json(
        changed=change
   )

main()
